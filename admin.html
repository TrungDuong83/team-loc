<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>ADMIN â€“ TEAM Lá»˜C</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  margin:0;font-family:Arial;background:#7A0C0C;color:#FFD966
}
.box{
  max-width:900px;margin:auto;padding:24px
}
h1,h2{color:#FFD966}
input,button{padding:10px;margin:6px}
button{background:#FFD966;border:none;font-weight:bold}
.danger{background:#C62828;color:#fff}
table{width:100%;border-collapse:collapse}
td,th{border:1px solid #FFD966;padding:6px;color:#fff}
.hidden{display:none}
</style>
</head>
<body>

<div class="box" id="loginBox">
  <h1>ğŸ” ADMIN LOGIN</h1>
  <input id="pass" type="password" placeholder="Máº­t kháº©u">
  <button onclick="login()">ÄÄƒng nháº­p</button>
</div>

<div class="box hidden" id="adminBox">
  <h2>ğŸ§¹ RESET TOÃ€N Bá»˜ Dá»® LIá»†U</h2>
  <button class="danger" onclick="resetAll()">RESET ALL</button>

  <hr>

  <h2>ğŸª‘ Cáº¤U HÃŒNH BÃ€N</h2>
  <input id="teamId" placeholder="MÃ£ bÃ n (VD: 1)">
  <input id="teamName" placeholder="TÃªn bÃ n (VD: BÃ n 1)">
  <input id="teamSize" type="number" placeholder="Sá»‘ ngÆ°á»i máº·c Ä‘á»‹nh">
  <button onclick="saveTeam()">LÆ°u / Cáº­p nháº­t</button>

  <table>
    <thead><tr><th>MÃ£</th><th>TÃªn</th><th>Sá»‘ ngÆ°á»i</th><th>XoÃ¡</th></tr></thead>
    <tbody id="teamList"></tbody>
  </table>
   <hr>
<h2>ğŸ” Táº O QR CHO BÃ€N (MÃƒ HOÃ)</h2>

<select id="qrTeamSelect"></select>
<button onclick="generateQR()">Táº O QR</button>

<p><b>Link QR:</b></p>
<input id="qrLink" style="width:100%" readonly>

<div id="qrBox" style="margin-top:20px"></div>
  <hr>

  <h2>ğŸ GIáº¢I THÆ¯á»NG</h2>
  <input id="rTitle" placeholder="TÃªn giáº£i">
  <input id="rContent" placeholder="Ná»™i dung">
  <input id="rWeight" type="number" placeholder="Weight">
  <button onclick="addReward()">ThÃªm</button>

  <table>
    <thead><tr><th>TÃªn</th><th>Ná»™i dung</th><th>Weight</th><th>XoÃ¡</th></tr></thead>
    <tbody id="rewardList"></tbody>
  </table>
</div>
<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
<script type="module">
import { db } from "./firebase.js";
import { ref,set,onValue,remove } from
 "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const ADMIN_PASS="YEP2026";
onst PREFIX = "TEAMLOC";
const SALT   = "2026";

window.login=()=>{
  if(pass.value===ADMIN_PASS){
    loginBox.classList.add("hidden");
    adminBox.classList.remove("hidden");
  } else alert("Sai máº­t kháº©u");
};

window.generateQR = ()=>{
  const teamId = qrTeamSelect.value;
  const raw = `${PREFIX}|${teamId}|${SALT}`;
  const token = btoa(raw);

  const url = `${location.origin}/join.html#k=${token}`;
  qrLink.value = url;

  document.getElementById("qrBox").innerHTML = "";
  new QRCode(document.getElementById("qrBox"), {
    text: url,
    width: 220,
    height: 220
  });
};
window.resetAll=async()=>{
  if(!confirm("RESET toÃ n bá»™ dá»¯ liá»‡u?"))return;
  await remove(ref(db,"teams"));
  await remove(ref(db,"runtime"));
  alert("ÄÃ£ reset");
};

window.saveTeam=async()=>{
  await set(ref(db,`config/teams/${teamId.value}`),{
    name:teamName.value,
    defaultSize:Number(teamSize.value)
  });
};

onValue(ref(db,"config/teams"),snap=>{
  teamList.innerHTML="";
  Object.entries(snap.val()||{}).forEach(([id,t])=>{
    teamList.innerHTML+=`
      <tr>
        <td>${id}</td><td>${t.name}</td><td>${t.defaultSize}</td>
        <td><button onclick="delTeam('${id}')">X</button></td>
      </tr>`;
  });
});
window.delTeam=id=>remove(ref(db,`config/teams/${id}`));

window.addReward=async()=>{
  const k=Date.now();
  await set(ref(db,`config/rewards/${k}`),{
    title:rTitle.value,content:rContent.value,weight:Number(rWeight.value)
  });
};
onValue(ref(db,"config/rewards"),snap=>{
  rewardList.innerHTML="";
  Object.entries(snap.val()||{}).forEach(([k,r])=>{
    rewardList.innerHTML+=`
      <tr>
        <td>${r.title}</td><td>${r.content}</td><td>${r.weight}</td>
        <td><button onclick="delReward('${k}')">X</button></td>
      </tr>`;
  });
});
window.delReward=k=>remove(ref(db,`config/rewards/${k}`));
</script>
</body>
</html>
