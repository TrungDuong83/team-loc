<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>TEAM LỘC – THAM GIA</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Arial;background:#06223A;color:#fff;text-align:center}
.box{max-width:400px;margin:auto;padding:30px}
input,button{width:100%;padding:12px;font-size:18px;margin-top:12px}
button{background:#FACC15;border:none;font-weight:bold}
</style>
</head>

<body>
<div class="box">
  <h2 id="title"></h2>
  <input id="name" placeholder="Nhập tên của bạn">
  <button onclick="join()">THAM GIA TEAM</button>
  <p id="status"></p>
</div>

<script type="module">
import { db } from './firebase.js';
import { ref, set, get, push } from
"https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const team = new URLSearchParams(location.search).get("team");
document.getElementById("title").innerText = `TEAM LỘC – BÀN SỐ ${team}`;

window.join = async () => {
  const name = document.getElementById("name").value.trim();
  if (!name) return alert("Vui lòng nhập tên");

  const teamRef = ref(db, `teams/${team}`);
  const snapshot = await get(teamRef);
  const data = snapshot.val();

  if (data?.status === "revealed")
    return alert("Team đã mở lộc");

  await push(ref(db, `teams/${team}/members`), name);
  document.getElementById("status").innerText =
    "✅ Đã tham gia. Vui lòng chờ trên màn hình chính.";
};
</script>
</body>
</html>
