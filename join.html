<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>TEAM Lá»˜C</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  margin:0;
  background:linear-gradient(135deg,#8E0E00,#1F1C18);
  color:#FFD966;
  font-family:Arial;text-align:center
}
.card{
  max-width:420px;margin:80px auto;padding:30px;
  background:rgba(0,0,0,0.4);border-radius:20px
}
h1{font-size:36px}
input,button{
  width:100%;padding:14px;margin-top:12px;
  font-size:18px;border:none
}
button{background:#FFD966;font-weight:bold}
.status{margin-top:10px;color:#fff}
.result{font-size:24px;color:#00E676;margin-top:15px}
</style>
</head>
<body>
<div class="card">
  <h1>ğŸ€ TEAM Lá»˜C ğŸ€</h1>
  <div id="teamName"></div>
  <div id="count"></div>

  <input id="name" placeholder="Nháº­p tÃªn cá»§a báº¡n">
  <button id="joinBtn">HÃI Lá»˜C</button>

  <div class="status" id="status"></div>
  <div class="result" id="result"></div>
</div>

<script type="module">
import { db } from "./firebase.js";
import { ref,onValue,push,get } from
 "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

let activeTeam=null;

onValue(ref(db,"runtime/activeTeam"),snap=>{
  activeTeam=snap.val();
  teamName.innerText=activeTeam?`BÃ n sá»‘ ${activeTeam}`:"ChÆ°a má»Ÿ bÃ n";
});

joinBtn.onclick=async()=>{
  if(!activeTeam)return;
  const teamRef=ref(db,`teams/${activeTeam}`);
  const snap=await get(teamRef);
  const d=snap.val();
  if(d.state!=="enabled") return status.innerText="â³ ChÆ°a Ä‘áº¿n lÆ°á»£t bÃ n nÃ y";
  const members=Object.values(d.members||{});
  if(members.includes(name.value))
    return alert("TÃªn Ä‘Ã£ tá»“n táº¡i");
  await push(ref(db,`teams/${activeTeam}/members`),name.value);
  status.innerText="âœ… ÄÃ£ tham gia, chá» má»Ÿ lá»™c";
};

onValue(ref(db,"teams"),snap=>{
  if(!activeTeam)return;
  const d=snap.val()?.[activeTeam];
  if(!d)return;
  count.innerText=`ÄÃ£ tham gia: ${Object.keys(d.members||{}).length}/${d.expected||"?"}`;
  if(d.state==="revealed")
    result.innerHTML=`ğŸ‰ ${d.result.title}<br>${d.result.content}`;
});
</script>
</body>
</html>
