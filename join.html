<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>TEAM Lá»˜C</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: Arial; background:#06223A; color:#fff; text-align:center }
.box { max-width:420px; margin:auto; padding:30px }
input, button { width:100%; padding:12px; font-size:18px; margin-top:12px }
button { background:#FACC15; border:none; font-weight:bold }
</style>
</head>

<body>
<div class="box">
  <h2 id="title"></h2>
  <div id="count"></div>

  <input id="name" placeholder="Nháº­p tÃªn cá»§a báº¡n">
  <button id="joinBtn">THAM GIA</button>

  <div id="status"></div>
  <div id="result"></div>
</div>

<script type="module">
import { db } from "./firebase.js";
import { ref, push, onValue, get } from
  "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const team = new URLSearchParams(location.search).get("team");
const teamRef = ref(db, `teams/${team}`);
title.innerText = `TEAM Lá»˜C â€“ BÃ€N ${team}`;

let joined = false;

onValue(teamRef, snap => {
  const d = snap.val();
  if (!d) return;

  const c = Object.keys(d.members || {}).length;
  count.innerText = `ÄÃ£ tham gia: ${c}/${d.expected || "?"}`;

  if (d.state !== "enabled") {
    joinBtn.disabled = true;
    status.innerText = "â³ BÃ n chÆ°a Ä‘Æ°á»£c má»Ÿ";
  }

  if (d.state === "revealed" && d.result) {
    result.innerHTML = `ğŸ‰ <b>${d.result.title}</b><br>${d.result.content}`;
  }
});

joinBtn.onclick = async () => {
  if (joined) return;

  const n = name.value.trim();
  if (!n) return alert("Nháº­p tÃªn");

  const snap = await get(teamRef);
  const data = snap.val();
  const members = Object.values(data.members || {});
  if (members.includes(n)) return alert("TÃªn Ä‘Ã£ tá»“n táº¡i");

  if (data.state !== "enabled") return alert("BÃ n chÆ°a má»Ÿ");

  await push(ref(db, `teams/${team}/members`), n);
  joined = true;
  joinBtn.disabled = true;
  status.innerText = "âœ… ÄÃ£ tham gia";
};
</script>
</body>
</html>
